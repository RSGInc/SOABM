Test,Table,ID_Column,Severity,Type,Expression,Test_Vals,Test_Description
HH_CTRAMP_Fields_Availability,households,hhid,Fatal,Test,test_val in households.columns,"PUMA,taz,maz,WGTP,serialno,gqflag,gqtype,htype,nwrkrs_esr,hhincadj,hhchild,np,hincp,ten,bld,adjinc,veh,hht,type,npf,hupac,hhid",Check if household file contains all the required fields for ABM
#HH_PUMA_valueCheck_agg,households,hhid,Fatal,Test,"set(households.PUMA)=={800,900}",,Check if PUMA values in the HH data matches and contains atleast one record for each pre-defined PUMA values
#HH_PUMA_valueCheck_disagg,households,hhid,Fatal,Test,"households.PUMA.apply(lambda x: True if x in [800,900] else False)",,Check if PUMA values in the HH data matches and contains atleast one record for each pre-defined PUMA values
HH_gqflag_valueCheck_agg,households,hhid,Fatal,Test,"set(households.gqflag)=={0,1}",,"Check if HH data matches the pre-defined gqflag categories [0=non-GQ, 1=Non-institutional GQ]"
HH_gqflag_valueCheck_disagg,households,hhid,Fatal,Test,"households.gqflag.apply(lambda x: True if x in [0,1] else False)",,"Check if HH data matches the pre-defined gqflag categories [0=non-GQ, 1=Non-institutional GQ]"
HH_htype_valueCheck_agg,households,hhid,Warning,Test,"set(households.htype)=={1,2,3,4,999}",,"Check if HH data matches the pre-defined htype categories [1=Single-family, 2=Multi-family, 3=Mobile-home, 4=Duplex, 999=GQ] at the regional level"
HH_htype_valueCheck_disagg,households,hhid,Warning,Test,"households.htype.apply(lambda x: True if x in [1,2,3,4,999] else False)",,"Check if HH data matches the pre-defined htype categories [1=Single-family, 2=Multi-family, 3=Mobile-home, 4=Duplex, 999=GQ] at the household level"
HH_nwrkrs_esr_valueCheck,households,hhid,Fatal,Test,(households.nwrkrs_esr >=0) & (households.nwrkrs_esr<=households.np),,Check if number of workers are within the valid range
HH_np_valueCheck,households,hhid,Fatal,Test,(households.np>0),,Check if np is a positive number
HH_ten_valueCheck_agg,households,hhid,Warning,Test,"set(households.ten)=={-8,1,2,3,4}",,"Check if HH data matches the pre-defined ten categories [-8=GQ, 1=Owned/Mortgage, 2=Owned/Free, 3=Rented, 4=Occupied]"
HH_ten_valueCheck_disagg,households,hhid,Warning,Test,"households.ten.apply(lambda x: True if x in [-8,1,2,3,4] else False)",,"Check if HH data matches the pre-defined ten categories [-8=GQ, 1=Owned/Mortgage, 2=Owned/Free, 3=Rented, 4=Occupied]"
HH_bld_valueCheck_agg,households,hhid,Warning,Test,"set(households.bld)=={-8,1,2,3,4,5,6,7,8,9,10}",,"Check if HH data matches the pre-defined bld categories [-8=GQ, 1=Mobile home or trailer, 2=One-family house detached, 3=One-family house attached, 4=2 Apartments, 5=3-4 Apartments, 6=5-9 Apartments, 7=10-19 Apartments, 8=20-49 Apartments, 9=50 or more apartments, 10=Boat, RV, van, etc.]"
HH_bld_valueCheck_disagg,households,hhid,Warning,Test,"households.bld.apply(lambda x: True if x in [-8,1,2,3,4,5,6,7,8,9,10] else False)",,"Check if HH data matches the pre-defined bld categories [-8=GQ, 1=Mobile home or trailer, 2=One-family house detached, 3=One-family house attached, 4=2 Apartments, 5=3-4 Apartments, 6=5-9 Apartments, 7=10-19 Apartments, 8=20-49 Apartments, 9=50 or more apartments, 10=Boat, RV, van, etc.]"
HH_hht_valueCheck_agg,households,hhid,Fatal,Test,"set(households.hht)=={-8,1,2,3,4,5,6,7}",,"Check if HH data matches the pre-defined hht categories [-8=N/A (GQ/vacant),1=Married-couple family household, 2=Other family hh, Male householder, no wife,3=Other family hh,Female householder, no husband, 4=Nonfamily hh, Male householder, living alone, 5=Nonfamily hh, Male householder, not living alone,6=Nonfamily hh, Female householder, living alone, 7=Nonfamily hh, Female householder, not living alone]"
HH_hht_valueCheck_disagg,households,hhid,Fatal,Test,"households.hht.apply(lambda x: True if x in [-8,1,2,3,4,5,6,7] else False)",,"Check if HH data matches the pre-defined hht categories [-8=N/A (GQ/vacant),1=Married-couple family household, 2=Other family hh, Male householder, no wife,3=Other family hh,Female householder, no husband, 4=Nonfamily hh, Male householder, living alone, 5=Nonfamily hh, Male householder, not living alone,6=Nonfamily hh, Female householder, living alone, 7=Nonfamily hh, Female householder, not living alone]"
HH_type_valueCheck_agg,households,hhid,Warning,Test,"set(households.type)=={1,3}",,"Check if HH data matches the pre-defined type categories [1=Housing unit, 3=Noninstitutional group quarters]"
HH_type_valueCheck_disagg,households,hhid,Warning,Test,"households.type.apply(lambda x: True if x in [1,3] else False)",,"Check if HH data matches the pre-defined type categories [1=Housing unit, 3=Noninstitutional group quarters]"
HH_npf_valueCheck_agg,households,hhid,Warning,Test,"set(households.npf)=={-8,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20}",,"Check if HH data matches the pre-defined npf categories [2-20], -8=NonFamily/GQ"
HH_npf_valueCheck_disagg,households,hhid,Warning,Test,"households.type.apply(lambda x: True if x in [-8,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20] else False)",,"Check if HH data matches the pre-defined npf categories [2-20], -8=NonFamily/GQ"
HH_hupac_valueCheck_agg,households,hhid,Warning,Test,"set(households.hupac)=={-8,1,2,3,4}",,"Check if HH data matches the pre-defined hupac categories [-8=N/A (GQ/vacant), 1=With children under 6 years only, 2=With children 6 to 17 years only, 3=With children under 6 years and 6 to 17 years, 4=No children]"
HH_hupac_valueCheck_disagg,households,hhid,Warning,Test,"households.type.apply(lambda x: True if x in [-8,1,2,3,4] else False)",,"Check if HH data matches the pre-defined hupac categories [-8=N/A (GQ/vacant), 1=With children under 6 years only, 2=With children 6 to 17 years only, 3=With children under 6 years and 6 to 17 years, 4=No children]"
HH_hhid_sequential_check,households,hhid,Fatal,Test,(min(households.hhid)==1) & (max(households.hhid)==len(set(households.hhid))),,Ensure HHID is sequential
zero_hh_mazs,maz_data_export,NO,NA,Calculation,maz_data_export.NO[maz_data_export.HH==0].tolist(),,Get list of MAZs with zero HH
HH_household_in_zeroHH_maz,households,hhid,Warning,Test,households.maz.apply(lambda x: True if x not in zero_hh_mazs else False),,Check if any household is assigned to a maz with zero households
PERSON_CTRAMP_Fields_Availability,persons_sorted_uni,PERID,Fatal,Test,test_val in persons_sorted_uni.columns,"PUMA,taz,maz,WGTP,serialno,sporder,employed,soc,occp,gqflag,gqtype,agep,sex,wkhp,esr,schg,wkw,mil,schl,majoruni,PERID,hhid",Check if person file contains all the required fields for ABM
#PERSON_PUMA_valueCheck_agg,persons_sorted_uni,PERID,Fatal,Test,"set(persons_sorted_uni.PUMA)=={800,900}",,Check if PUMA values in the Person data matches and contains atleast one record for each pre-defined PUMA values
#PERSON_PUMA_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.PUMA.apply(lambda x: True if x in [800,900] else False)",,Check if PUMA values in the Person data matches and contains atleast one record for each pre-defined PUMA values
PERSON_sporder_valueCheck,persons_sorted_uni,PERID,Fatal,Test,(persons_sorted_uni.sporder>0),,sporder must be a positive number
PERSON_employed_valueCheck_agg,persons_sorted_uni,PERID,Fatal,Test,"set(persons_sorted_uni.employed)=={0,1}",,"Check if Person data matches the pre-defined employed categories [0=unemployed, 1=employed]"
PERSON_employed_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.employed.apply(lambda x: True if x in [0,1] else False)",,"Check if Person data matches the pre-defined employed categories [0=unemployed, 1=employed]"
PERSON_occp_valueCheck_agg,persons_sorted_uni,PERID,Fatal,Test,"set(persons_sorted_uni.occp)=={1,2,3,4,5,6,999}",,"Check if occp values in the Person data matches the pre-defined occupation categories [1=Management, Business, Science, and Arts, 2=White Collar, 3=Blue Collar, 4=Sales and Office Support, 5=Natural Resources, Construction, and Maintenance 6=Production, Transportation, and Material Moving 999=not a worker]"
PERSON_occp_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.occp.apply(lambda x: True if x in [1,2,3,4,5,6,999] else False)",,"Check if occp values in the Person data matches the pre-defined occupation categories [1=Management, Business, Science, and Arts, 2=White Collar, 3=Blue Collar, 4=Sales and Office Support, 5=Natural Resources, Construction, and Maintenance 6=Production, Transportation, and Material Moving 999=not a worker]"
PERSON_gqflag_valueCheck_agg,persons_sorted_uni,PERID,Fatal,Test,"set(persons_sorted_uni.gqflag)=={0,1}",,"Check if Person data matches the pre-defined gqflag categories [0=non-GQ, 1=Non-institutional GQ]"
PERSON_gqflag_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.gqflag.apply(lambda x: True if x in [0,1] else False)",,"Check if Person data matches the pre-defined gqflag categories [0=non-GQ, 1=Non-institutional GQ]"
PERSON_agep_valueCheck,persons_sorted_uni,PERID,Fatal,Test,(persons_sorted_uni.agep>=0),,sporder must be a positive number
PERSON_gender_valueCheck_agg,persons_sorted_uni,PERID,Fatal,Test,"set(persons_sorted_uni.sex)=={1,2}",,"Check if Person data matches the pre-defined gender categories [1=male, 2=female]"
PERSON_gender_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.sex.apply(lambda x: True if x in [1,2] else False)",,"Check if Person data matches the pre-defined gender categories [1=male, 2=female]"
PERSON_esr_valueCheck_agg,persons_sorted_uni,PERID,Warning,Test,"set(persons_sorted_uni.esr)=={-8,1,2,3,4,5,6}",,"Check if esr values in the Person data matches the pre-defined esr categories [-8=less than 16 years old/did not work, 1=Civilian employed, at work, 2 =Civilian employed, with a job but not at work, 3=Unemployed, 4=Armed forces, at work, 5=Armed forces, with a job but not at work, 6=Not in labor force]"
PERSON_esr_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.esr.apply(lambda x: True if x in [-8,1,2,3,4,5,6] else False)",,"Check if esr values in the Person data matches the pre-defined esr categories [-8=less than 16 years old/did not work, 1=Civilian employed, at work, 2 =Civilian employed, with a job but not at work, 3=Unemployed, 4=Armed forces, at work, 5=Armed forces, with a job but not at work, 6=Not in labor force]"
PERSON_schg_valueCheck_agg,persons_sorted_uni,PERID,Warning,Test,"set(persons_sorted_uni.schg)=={-8,1,2,3,4,5,6,7}",,"Check if schg values in the Person data matches the pre-defined schg categories [-8=under 3 years or not enrolled, 1=Nursery school or preschool, 2=Kindergarten, 3=Grade 1 to grade 4, 4=Grade 5 to grade 8, 5=Grade 9 to grade 12, 6=College undergraduate, 7=Graduate or professional school]. There must be at least one person for each category and no person with a code other than pre-defined values"
PERSON_schg_valueCheck_disagg,persons_sorted_uni,PERID,Warning,Test,"persons_sorted_uni.schg.apply(lambda x: True if x in [-8,1,2,3,4,5,6,7] else False)",,"Check if schg values in the Person data matches the pre-defined schg categories [-8=under 3 years or not enrolled, 1=Nursery school or preschool, 2=Kindergarten, 3=Grade 1 to grade 4, 4=Grade 5 to grade 8, 5=Grade 9 to grade 12, 6=College undergraduate, 7=Graduate or professional school]. At person level"
PERSON_wkw_valueCheck_agg,persons_sorted_uni,PERID,Fatal,Test,"set(persons_sorted_uni.wkw)=={-8,1,2,3,4,5,6}",,"Check if wkw values in the Person data matches the pre-defined wkw categories [-8= less than 16 years old/did not work, 1=50 to 52, 2=48 to 49, 3 =40 to 47, 4=27 to 39, 5=14 to 26, 6=less than 14]"
PERSON_wkw_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.wkw.apply(lambda x: True if x in [-8,1,2,3,4,5,6] else False)",,"Check if wkw values in the Person data matches the pre-defined wkw categories [-8= less than 16 years old/did not work, 1=50 to 52, 2=48 to 49, 3 =40 to 47, 4=27 to 39, 5=14 to 26, 6=less than 14]"
PERSON_schl_valueCheck_agg,persons_sorted_uni,PERID,Warning,Test,"set(persons_sorted_uni.schl)=={-8,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16}",,"Check if schl values in the Person data matches the pre-defined schl categories [-8=Under 3 years,1=No schooling completed, 2=Nursery school to 4th grade, 3=5th grade or 6th grade, 4=7th grade or 8th grade, 5=9th grade, 6=10th grade, 7=11th grade, 8=12th grade, no diploma, 9=High school graduate, 10=Some college, but less than 1 year,11=One or more years of college, no degree, 12=Associate degree, 13=Bachelor’s degree,14=Master’s degree, 15=Professional degree, 16=Doctorate degree]. There must be at least one person for each category and no person with a code other than pre-defined values"
PERSON_schl_valueCheck_disagg,persons_sorted_uni,PERID,Warning,Test,"persons_sorted_uni.schl.apply(lambda x: True if x in [-8,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16] else False)",,"Check if schl values in the Person data matches the pre-defined schl categories [-8=Under 3 years,1=No schooling completed, 2=Nursery school to 4th grade, 3=5th grade or 6th grade, 4=7th grade or 8th grade, 5=9th grade, 6=10th grade, 7=11th grade, 8=12th grade, no diploma, 9=High school graduate, 10=Some college, but less than 1 year,11=One or more years of college, no degree, 12=Associate degree, 13=Bachelor’s degree,14=Master’s degree, 15=Professional degree, 16=Doctorate degree]. At person level"
PERSON_majoruni_valueCheck_agg,persons_sorted_uni,PERID,Warning,Test,"set(persons_sorted_uni.majoruni)=={1,0}",,Check if Person data matches the pre-defined majoruni categories [1=major university student (0 = not a major university student)]. Currently no Major university model
PERSON_majoruni_valueCheck_disagg,persons_sorted_uni,PERID,Fatal,Test,"persons_sorted_uni.majoruni.apply(lambda x: True if x in [1,0] else False)",,Check if Person data matches the pre-defined majoruni categories [1=major university student (0 = not a major university student)]. Currently no Major university model
PERSON_hhid_sequential_check,persons_sorted_uni,PERID,Fatal,Test,(min(persons_sorted_uni.hhid)==1) & (max(persons_sorted_uni.hhid)==len(set(households.hhid))),,Ensure HHID in the Person data is sequential
#PERSON_PERID_sequential_check,persons_sorted_uni,PERID,Fatal,Test,(min(persons_sorted_uni.PERID)==1) & (max(persons_sorted_uni.PERID)==len(set(persons_sorted_uni.PERID))),,Ensure PERID in the Person data is sequential
MAZ_CTRAMP_Fields_Availability,maz_data_export,NO,Fatal,Test,test_val in maz_data_export.columns,"NO,TAZ,COUNTY,DISTNAME,DISTID,EMP_CONSTR,EMP_WHOLE,EMP_RETAIL,EMP_SPORT,EMP_ACCFD,EMP_AGR,EMP_MIN,EMP_UTIL,EMP_FOOD,EMP_WOOD,EMP_METAL,EMP_TRANS,EMP_POSTAL,EMP_INFO,EMP_FINANC,EMP_REALES,EMP_PROF,EMP_MGMT,EMP_ADMIN,EMP_EDUC,EMP_HEALTH,EMP_ARTS,EMP_OTHER,EMP_PUBADM,EMP_TOTAL,ENROLLK_8,ENROLL9_12,ENROLLCOLL,ENROLLCOOT,ENROLLADSC,universitySqFtClass,universitySqFtOffice,universitySqFtRec,ECH_DIST,HCH_DIST,SCHDIST_NA,SCHDIST,HOTELRMTOT,PARKAREA,HSTALLSOTH,HSTALLSSAM,HPARKCOST,NUMFREEHRS,DSTALLSOTH,DSTALLSSAM,DPARKCOST,MSTALLSOTH,MSTALLSSAM,MPARKCOST,WRK_EXT_PR,SCHDIST_NA,SCHDIST,TERMTIME,PARKACRES",Check if MAZ data contains all the required fields for ABM. The CSV exporter should throw an error if any field is missing in the Visum object
MAZ_NO_valueCheck,maz_data_export,NO,Fatal,Test,"maz_data_export.NO.apply(lambda x: True if x in range(10001,239303) else False)",,Check if original MAZ IDs are within valid range
taz_id_list,taz_data,NO,NA,Calculation,set(taz_data.NO.values),,
MAZ_TAZ_valueCheck,maz_data_export,NO,Fatal,Test,maz_data_export.TAZ.apply(lambda x: True if x in taz_id_list else False),,Check if TAZ ID in the MAZ data line up with TAZ IDs in the TAZ data
maz_total_employment,maz_data_export,NO,NA,Calculation,maz_data_export[[col for col in maz_data_export if (col.startswith('EMP')) and not (col.endswith('TOTAL'))]].sum(axis=1),,
MAZ_TotalEmployment_CalcCheck,maz_data_export,NO,Logical,Test,maz_data_export.EMP_TOTAL==maz_total_employment,,Check is employment by industry adds upto total employment
MAZ_PARKAREA_valueCheck_agg,maz_data_export,NO,Warning,Test,"set(maz_data_export.PARKAREA)=={0,1,2,3,4}",,"Check if PARKAREA values in the MAZ data matches the pre-defined PARKAREA categories [0, 1, 2, 3, 4] aggregately. Test fails if any category is missing completely"
MAZ_PARKAREA_valueCheck_disagg,maz_data_export,NO,Fatal,Test,"maz_data_export.PARKAREA.apply(lambda x: True if x in [0,1,2,3,4] else False)",,"Check if PARKAREA values in the MAZ data matches the pre-defined PARKAREA categories [0, 1, 2, 3, 4] for each MAZ"
MAZ_ECHDIST_K_8ENROLL_Check,maz_data_export,NO,Fatal,Test,"(maz_data_export[['ECH_DIST','ENROLLK_8']].groupby('ECH_DIST').ENROLLK_8.sum() > 0).all()",,Check if each ECH school district has at least one MAZ with K_8 enrollment
MAZ_HCHDIST_9_12ENROLL_Check,maz_data_export,NO,Fatal,Test,"(maz_data_export[['HCH_DIST','ENROLL9_12']].groupby('HCH_DIST').ENROLL9_12.sum() > 0).all()",,Check if each HCH school district has at least one MAZ with 9_12 enrollment
household_POP,households,hhid,NA,Calculation,"households[['maz','np']].groupby('maz').sum().reset_index()",,Compute MAZ level population from household table
mazdata_synpop_POP,maz_data_export,NO,NA,Calculation,"pd.merge(maz_data_export[['NO','POP']],household_POP, how='left', left_on='NO', right_on = 'maz').fillna(0)",,Combine mazdata and household population for comparison
MAZ_SYNPOP_Consistency_POP,maz_data_export,NO,Warning,Test,mazdata_synpop_POP.POP == mazdata_synpop_POP.np,,Check if MAZ-level population matches between MAZ data and household table. This check not required since the model updates the population from input synthetic population. The check will fail for all MAZs containing visitor population
household_HH,households,hhid,NA,Calculation,"households[['maz','np']].groupby('maz').count().reset_index()",,Compute MAZ level number of households from household table
mazdata_synpop_HH,maz_data_export,NO,NA,Calculation,"pd.merge(maz_data_export[['NO','HH']],household_HH, how='left', left_on='NO', right_on = 'maz').fillna(0)",,Combine mazdata and  number of households from household table for comparison
MAZ_SYNPOP_Consistency_HH,maz_data_export,NO,Warning,Test,mazdata_synpop_HH.HH == mazdata_synpop_HH.np,,Check if number of households matches between MAZ data and household table. This check not required since the model updates the number of households from input synthetic population. The check will fail for all MAZs containing visitor population
maz_transpose,maz_data_export,NO,NA,Calculation,maz_data_export[[col for col in maz_data_export if (col.startswith('EMP')) and not (col.endswith('TOTAL'))]].transpose(),,Get Employment X MAZ matrix
occ,maz_data_export,NO,NA,Calculation,occFactors[maz_data_export[[col for col in maz_data_export if (col.startswith('EMP')) and not (col.endswith('TOTAL'))]].columns],,Select relevant columns from the occupation factors
maz_occp_jobs,maz_data_export,NO,NA,Calculation,occ.dot(maz_transpose).sum(axis=1),,Compute jobs by occupation categories from MAZ data
person_occ_workers,persons_sorted_uni,PERID,NA,Calculation,persons_sorted_uni.occp.value_counts(),,Compute workers by occupation type from person table
MAZ_PERSON_Worker_OCC1,maz_data_export,NO,Logical,Test,0.9 < maz_occp_jobs[0]/person_occ_workers[1] < 1.1,,Compare jobs to worker for occupation category 1. Must be within 10%
MAZ_PERSON_Worker_OCC2,maz_data_export,NO,Logical,Test,0.9 < maz_occp_jobs[1]/person_occ_workers[2] < 1.1,,Compare jobs to worker for occupation category 2. Must be within 10%
MAZ_PERSON_Worker_OCC3,maz_data_export,NO,Logical,Test,0.9 < maz_occp_jobs[2]/person_occ_workers[3] < 1.1,,Compare jobs to worker for occupation category 3. Must be within 10%
MAZ_PERSON_Worker_OCC4,maz_data_export,NO,Logical,Test,0.9 < maz_occp_jobs[3]/person_occ_workers[4] < 1.1,,Compare jobs to worker for occupation category 4. Must be within 10%
MAZ_PERSON_Worker_OCC5,maz_data_export,NO,Logical,Test,0.9 < maz_occp_jobs[4]/person_occ_workers[5] < 1.1,,Compare jobs to worker for occupation category 5. Must be within 10%
MAZ_PERSON_Worker_OCC6,maz_data_export,NO,Logical,Test,0.9 < maz_occp_jobs[5]/person_occ_workers[6] < 1.1,,Compare jobs to worker for occupation category 6. Must be within 10%
num_hh_wrkrs,households,hhid,NA,Calculation,sum(households.nwrkrs_esr),,Compute number of workers in the households table
MAZ_PERSON_all_worker_match,maz_data_export,NO,Warning,Test,0.9 < sum(maz_data_export.EMP_TOTAL)/sum(households.nwrkrs_esr) < 1.1,,Test to compare number of workers in synthetic population and total occupation in MAZ data. Must be within 10%
MAZ_ENROLLK_8_EduJob_Check,maz_data_export,NO,Logical,Test,"maz_data_export[['EMP_EDUC','EMP_PROF', 'ENROLLK_8']].apply(lambda row: True if ((row.ENROLLK_8 == 0) or ((row.ENROLLK_8>0) and (row.EMP_EDUC>0 or row.EMP_PROF>0))) else False, axis=1)",,Check if MAZs with K_8 enrollment have some education jobs 
MAZ_ENROLL9_12_EduJob_Check,maz_data_export,NO,Logical,Test,"maz_data_export[['EMP_EDUC','EMP_PROF', 'ENROLL9_12']].apply(lambda row: True if ((row.ENROLL9_12 == 0) or ((row.ENROLL9_12>0) and (row.EMP_EDUC>0 or row.EMP_PROF>0))) else False, axis=1)",,Check if MAZs with 9_12 enrollment have some education jobs 
persons_K_8,persons_sorted_uni,PERID,NA,Calculation,persons_sorted_uni[(persons_sorted_uni.schg<5) & (persons_sorted_uni.agep<16) & (persons_sorted_uni.agep>=6)].PERID.count(),,Number of K_8 students in person table
persons_9_12,persons_sorted_uni,PERID,NA,Calculation,"persons_sorted_uni[(persons_sorted_uni.schg==5) & ((persons_sorted_uni.agep<=16) | ((persons_sorted_uni.agep<=19) & (persons_sorted_uni.esr.isin([0,3,6]))))].PERID.count()",,Number of 9_12 students in person table
persons_univ,persons_sorted_uni,PERID,NA,Calculation,persons_sorted_uni[(persons_sorted_uni.schg>5) & (persons_sorted_uni.agep>=16)].PERID.count(),,Number of univ students in person table
MAZ_ENROLLK_8_PERSON_Check,maz_data_export,NO,Logical,Test,0.9 < sum(maz_data_export.ENROLLK_8)/persons_K_8 < 1.1,,Check if K_8 enrollments match reasonably with K_8 students. Within 10%.
MAZ_ENROLL9_12_PERSON_Check,maz_data_export,NO,Logical,Test,0.9 < sum(maz_data_export.ENROLL9_12)/persons_9_12 < 1.1,,Check if 9_12 enrollments match reasonably with 9_12 students. Within 10%.
MAZ_ENROLLUniv_PERSON_Check,maz_data_export,NO,Logical,Test,0.9 < sum(maz_data_export.ENROLLCOLL + maz_data_export.ENROLLCOOT + maz_data_export.ENROLLADSC)/persons_univ < 1.1,,Check if univ enrollments match reasonably with univ students. Within 10%.
NODE_CTRAMP_Fields_Availability,node_data,NO,Fatal,Test,test_val in node_data.columns,"NO,XCOORD,YCOORD,CONTROLTYPE",Check if Node data contains all the required fields for ABM. The CSV exporter should throw an error if any field is missing in the Visum object
NODE_CONTROLTYPE_MAJFLOW_Check,node_data,NO,Warning,Test,(node_data.CONTROLTYPE>0) & (node_data.MajorFlowOri1>0) & (node_data.MajorFlowOri2>0),,Major flow must be set for any intersection with a known ControlType
MNODE_Node_ConrolType_Check,mnode_data,NO,Fatal,Test,"mnode_data.NODES_CTYPE.apply(lambda x: True if ('NODECONTROLNONE' in set(x.split(','))) & (len(set(x.split(',')))==1) else False)",,All neighboring nodes of the main node should have unknown control type
link_tsys,link_data,NO,NA,Calculation,"link_data[['TSYSSET','PLANNO','TONODE_CTYPE','TOMNODE_CTYPE','V0PRT']].replace(np.nan, '', regex=True)",,Covert nans to empty string to perform checks on string columns
LINK_TSYS_PLANNO_Compatibility,link_data,NO,Logical,Test,"link_tsys.apply(lambda row: False if ('Walk' in set(row.TSYSSET.split(','))) & (row.PLANNO == 1) else True, axis=1)",,Walking should not be allowed on freeways
LINK_FWY_NODE_CONTROL_Check,link_data,NO,Logical,Test,"link_tsys.apply(lambda row: False if (not row.TONODE_CTYPE in [0,1]) & (row.PLANNO==1) else True, axis=1)",,Nodes on freeways should be uncontrolled or unknown
LINK_FWY_MNODE_CONTROL_Check,link_data,NO,Logical,Test,"link_tsys.apply(lambda row: False if (not row.TOMNODE_CTYPE in [0,1,'None']) & (row.PLANNO==1) else True, axis=1)",,Main Nodes on freeways should be uncontrolled or unknown
LINK_MEDIAN_valueCheck,link_data,NO,Fatal,Test,"link_data.MEDIAN.apply(lambda x: True if x in [0,1,2,3] else False)",,“MEDIAN” should be populated with an integer between 0 and 4
LINK_AUX_LANES_valueCheck,link_data,NO,Fatal,Test,"link_data.AUX_LANES.apply(lambda x: True if x in [0,1,2] else False)",,“AUX_LANES” should be populated with an integer representing the number of auxiliary lanes (between 0-2)
LINK_FUNCTIONAL_CLASS_valueCheck,link_data,NO,Fatal,Test,"link_data.PLANNO.apply(lambda x: True if x in [1,3,4,5,6,7,30,998] else False)",,All links should have a valid functional class
LINK_NUMLANES_Sanity_Check,link_data,NO,Warning,Test,link_data.NUMLANES<=6,,Check for extreme number of links
LINK_POSITIVE_LENGTH,link_data,NO,Logical,Test,link_data.LENGTH>0,,All link length should be greater than zero
LINK_LENGTH_DIR_Comparison,link_data,NO,Logical,Test,(link_data.LENGTH/link_data.LENGTHDIR >= 0.95) & (link_data.LENGTH/link_data.LENGTHDIR <= 1.05),,Check against the internal length field in Visum (Length Direct) and ensure that the length field is in some reasonable bound of the Visum internal calculated length. Within 5%
LINK_LENGTH_REV_Comparison,link_data,NO,Logical,Test,(link_data.LENGTH/link_data.LENGTHREV >= 0.95) & (link_data.LENGTH/link_data.LENGTHREV <= 1.05),,Checks if lengths in opposite direction match reasonably. Within 5%
LINK_LOW_FFS_Check,link_data,NO,Logical,Test,"(link_tsys.V0PRT>=10) | ((link_tsys.V0PRT==3) & (link_tsys.PLANNO==998)) | ((link_tsys.TSYSSET.apply(lambda x: True if ({'Walk','Bike'}.issubset(set(x.split(',')))) else False)) & (link_tsys.V0PRT==3))",,"All link speeds must be greater than 10 mph, except for ones with 3 mph"
LINK_FFS_Interval_of_5,link_data,NO,Fatal,Test,(link_data.V0PRT % 5 == 0) | (link_data.V0PRT==3),,All link FFS must be a multiple of 5 or 3 mph
LINK_Interstate_MaxFFS,link_data,NO,Logical,Test,((link_data.PLANNO == 1) & (link_data.V0PRT<=65)) | (link_data.PLANNO != 1),,Max FFS for Interstates is 65 mph
LINK_NonInterstate_MaxFFS,link_data,NO,Logical,Test,((link_data.PLANNO != 1) & (link_data.V0PRT<=55)) | (link_data.PLANNO == 1),,Max FFS for Non-Interstates is 55 mph
LINK_MidLinkCapAdj_LE500,link_data,NO,Warning,Test,link_data.MID_LINK_CAP_ADJ<=500,,Mid link capacity adjustment should be less than 500
LINK_ProgressionFactorRange_Check,link_data,NO,Warning,Test,(link_data.PROGRESSION_FACTOR>=0.5) & (link_data.PROGRESSION_FACTOR<=1.2),,PROGRESSION_FACTOR is greater than 0.5 but less than 1.2
TAP_FAREZONE_Check,tap_data,NO,Fatal,Test,tap_data.FAREZONE.apply(lambda x: True if x in set(fares.FROMFAREZONE) else False),,Each TAP should have a valid FAREZONE
TAP_Line_Access_Check,tap_data,NO,Fatal,Test,tap_data.LINES.fillna('').apply(lambda x: True if len(x)>0 else False),,Check if each TAP is served by a transit line
TSYS_Availability_Check,tystems,Code,Fatal,Test,"set(tsystems[tsystems.Type==""PUT""].Code) == {'Bus', 'ComRail', 'ExpBus', 'LightRail'}",,Check if all Public Transport Systems are available
LINE_Tsys_Coding_Check,line_data,NAME,Fatal,Test,"line_data.TSYSCODE.apply(lambda x: True if x in {'Bus', 'ComRail', 'ExpBus', 'LightRail'} else False)",,"Check if all coded lines belong to one of the following Tsys {'Bus', 'ComRail', 'ExpBus', 'LightRail'}"
LINEROUTE_Tsys_Coding_Check,lineroute_data,NAME,Fatal,Test,"lineroute_data.TSYSCODE.apply(lambda x: True if x in {'Bus', 'ComRail', 'ExpBus', 'LightRail'} else False)",,"Check if all coded line routes belong to one of the following Tsys {'Bus', 'ComRail', 'ExpBus', 'LightRail'}"
LINEROUTE_EA_Headway_Check,lineroute_data,NAME,Fatal,Test,lineroute_data.EA_HEADWAY>0,,Check if each route has a valid headway value by period (>0) 
LINEROUTE_AM_Headway_Check,lineroute_data,NAME,Fatal,Test,lineroute_data.AM_HEADWAY>0,,Check if each route has a valid headway value by period (>0) 
LINEROUTE_MD_Headway_Check,lineroute_data,NAME,Fatal,Test,lineroute_data.MD_HEADWAY>0,,Check if each route has a valid headway value by period (>0) 
LINEROUTE_PM_Headway_Check,lineroute_data,NAME,Fatal,Test,lineroute_data.PM_HEADWAY>0,,Check if each route has a valid headway value by period (>0) 
LINEROUTE_EV_Headway_Check,lineroute_data,NAME,Fatal,Test,lineroute_data.EV_HEADWAY>0,,Check if each route has a valid headway value by period (>0) 
LINEROUTE_Unique_Names_Check,lineroute_data,NAME,Fatal,Test,len(set(lineroute_data.NAME)) == len(lineroute_data.NAME),,All transit line route names must be unique
TIMEPROFILE_LineRoute_Check,lineroute_data,NAME,Fatal,Test,lineroute_data.NAME.apply(lambda x: True if x in set(time_profiles.LINEROUTENAME) else False),,Check if each route has a time profile
NETWORK_EA_TOD_Factor_Check,link_data,NO,Warning,Test,link_data.TOD_FACTOR_EA==4,,Check if each link has a valid pre-defined TOD factor
NETWORK_AM_TOD_Factor_Check,link_data,NO,Warning,Test,link_data.TOD_FACTOR_AM==1.5,,Check if each link has a valid pre-defined TOD factor
NETWORK_MD_TOD_Factor_Check,link_data,NO,Warning,Test,link_data.TOD_FACTOR_MD==8,,Check if each link has a valid pre-defined TOD factor
NETWORK_PM_TOD_Factor_Check,link_data,NO,Warning,Test,link_data.TOD_FACTOR_PM==2,,Check if each link has a valid pre-defined TOD factor
NETWORK_EV_TOD_Factor_Check,link_data,NO,Warning,Test,link_data.TOD_FACTOR_EV==8.5,,Check if each link has a valid pre-defined TOD factor
VDF_GC4LEG_Range_Check,vdf_lookup_table,ID,Fatal,Test,"(min(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='gc4leg') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())>0) & (max(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='gc4leg') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())<=1)","3,4,5,6,7,30",Check if GC ratio is in the right range for 4 leg intersections
VDF_GC3LEG_Range_Check,vdf_lookup_table,ID,Fatal,Test,"(min(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='gc3leg') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())>0) & (max(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='gc3leg') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())<=1)","3,4,5,6,7,30",Check if GC ratio is in the right range for 3 leg intersections
VDF_STOP_Range_Check,vdf_lookup_table,ID,Fatal,Test,"(min(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='stop') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())>0) & (max(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='stop') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())<=1)","3,4,5,6,7,30",Check if GC ratio is in the right range for stop intersections
VDF_ROUNDABOUT_Range_Check,vdf_lookup_table,ID,Warning,Test,"(min(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='roundabout') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())>0) & (max(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='roundabout') & (vdf_lookup_table.PLANNO==int(test_val)),['1','3','4','5','6','7','30']].squeeze())<=1)","3,4,5,6,7,30",Check if GC ratio is in the right range for roundabouts
VDF_CycleLength_Value_Check,vdf_lookup_table,ID,Warning,Test,"set(vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='cyclelength') & (vdf_lookup_table.PLANNO==int(test_val)),['3','4','5','6','7','30']].squeeze())=={60}","3,4,5,6,7,30",Check if Cycle length equal the pre-defined values
VDF_ThruCap_PLANNO1_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='thru_cap_per_lane') & (vdf_lookup_table.PLANNO==1),['1']].squeeze()==1900",,Check if freeway capacity equals the pre-defined value
VDF_ThruCap_PLANNO2_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='thru_cap_per_lane') & (vdf_lookup_table.PLANNO==3),['3']].squeeze()==1800",,Check if principal arterial capacity equals the pre-defined value
VDF_ThruCap_PLANNO3_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='thru_cap_per_lane') & (vdf_lookup_table.PLANNO==4),['4']].squeeze()==1800",,Check if minor arterial capacity equals the pre-defined value
VDF_ThruCap_PLANNO4_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='thru_cap_per_lane') & (vdf_lookup_table.PLANNO==5),['5']].squeeze()==1400",,Check if major collector capacity equals the pre-defined value
VDF_ThruCap_PLANNO5_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='thru_cap_per_lane') & (vdf_lookup_table.PLANNO==6),['6']].squeeze()==1200",,Check if minor collector capacity equals the pre-defined value
VDF_ThruCap_PLANNO6_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='thru_cap_per_lane') & (vdf_lookup_table.PLANNO==7),['7']].squeeze()==1200",,Check if local road capacity equals the pre-defined value
VDF_ThruCap_PLANNO7_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='thru_cap_per_lane') & (vdf_lookup_table.PLANNO==30),['30']].squeeze()==1400",,Check if ramp capacity equals the pre-defined value
VDF_TurnCap_PLANNO1_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='turn_cap_per_lane') & (vdf_lookup_table.PLANNO==1),['1']].squeeze()==250",,Check if freeway turn capacity equals the pre-defined value
VDF_TurnCap_PLANNO2_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='turn_cap_per_lane') & (vdf_lookup_table.PLANNO==3),['3']].squeeze()==250",,Check if principal arterial turn capacity equals the pre-defined value
VDF_TurnCap_PLANNO3_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='turn_cap_per_lane') & (vdf_lookup_table.PLANNO==4),['4']].squeeze()==150",,Check if minor arterial turn capacity equals the pre-defined value
VDF_TurnCap_PLANNO4_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='turn_cap_per_lane') & (vdf_lookup_table.PLANNO==5),['5']].squeeze()==150",,Check if major collector turn capacity equals the pre-defined value
VDF_TurnCap_PLANNO5_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='turn_cap_per_lane') & (vdf_lookup_table.PLANNO==6),['6']].squeeze()==150",,Check if minor collector turn capacity equals the pre-defined value
VDF_TurnCap_PLANNO6_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='turn_cap_per_lane') & (vdf_lookup_table.PLANNO==7),['7']].squeeze()==150",,Check if local road turn capacity equals the pre-defined value
VDF_TurnCap_PLANNO7_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='turn_cap_per_lane') & (vdf_lookup_table.PLANNO==30),['30']].squeeze()==150",,Check if ramp turn capacity equals the pre-defined value
VDF_AppCap_PLANNO1_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='int_app_cap_per_lane') & (vdf_lookup_table.PLANNO==1),['1']].squeeze()==1900",,Check if freeway app capacity equals the pre-defined value
VDF_AppCap_PLANNO2_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='int_app_cap_per_lane') & (vdf_lookup_table.PLANNO==3),['3']].squeeze()==1800",,Check if principal arterial app capacity equals the pre-defined value
VDF_AppCap_PLANNO3_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='int_app_cap_per_lane') & (vdf_lookup_table.PLANNO==4),['4']].squeeze()==1800",,Check if minor arterial app capacity equals the pre-defined value
VDF_AppCap_PLANNO4_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='int_app_cap_per_lane') & (vdf_lookup_table.PLANNO==5),['5']].squeeze()==1400",,Check if major collector app capacity equals the pre-defined value
VDF_AppCap_PLANNO5_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='int_app_cap_per_lane') & (vdf_lookup_table.PLANNO==6),['6']].squeeze()==1200",,Check if minor collector app capacity equals the pre-defined value
VDF_AppCap_PLANNO6_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='int_app_cap_per_lane') & (vdf_lookup_table.PLANNO==7),['7']].squeeze()==1200",,Check if local road app capacity equals the pre-defined value
VDF_AppCap_PLANNO7_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='int_app_cap_per_lane') & (vdf_lookup_table.PLANNO==30),['30']].squeeze()==1400",,Check if ramp app capacity equals the pre-defined value
VDF_AuxCap_PLANNO1_Value_Check,vdf_lookup_table,ID,Warning,Test,"vdf_lookup_table.loc[(vdf_lookup_table.VALUE=='freeway_cap_per_auxlane') & (vdf_lookup_table.PLANNO==1),['1']].squeeze()==1200",,Check if freeway freeway_cap_per_auxlane equals the pre-defined value
CONNECTORS_Zone_Check,connectors_data,ID,Fatal,Test,set(taz_data.NO)==set(connectors_data.ZONENO),,Check if each TAZ has a connector
